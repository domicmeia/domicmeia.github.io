---
layout: post
category: K8s
use_math: true
---

## 쿠버네티스?

쿠버네티스는 컨테이너가 다운되었을 때 자동으로 다시 시작해주고 트래픽이 몰리면 자동으로 확장해주는 도구이다. 즉, 컨테이너로 분산 시스템을 실행하기 위한 플랫폼이다. Kubernetes Cluster Architecture는 다음과 같다.

![k1](./image/k1.png)

- 맨 위에 etcd가 있다. etcd는 Kubernetes cluster에서 cluster의 모든 상태를 저장하는 데 사용되는 Key-value 저장소이다. etcd 노드의 수는 Raft consensus 프로토콜에 따라 홀수여야 한다. Cluster State를 설명할 때 Cluster에서 실행 중인 어플리케이션에서 생성되거나 사용되는 데이터는 포함되지 않는다. 대신 Cluster의 Topology나 어떤 서비스가 실행되고 있는 지, 네트워크 설정, 사용되는 암호 등에 대한 모든 정보를 포함한다.

   - 따라서, 이 etcd cluster는 전체 클러스에 Mission-critical하므로 **절대로 운영 환경이나, 고가용성이 필요한 환경에서 단일 etcd 서버만 실행해서는 안된다.**

- 그런 다음 Kubernetes의 master 노드들이 있다. etcd 노드들과 비슷하게 Consensus Group의 형태로 되어있다. Master 노드들도 홀수여야 한다. 단일 master로 Cluster를 실행할 수는 있지만 프로덕션 또는 Mission-critical 시스템에서는 실행할 수 없다. 이 환경에서는 최소 3개의 master가 필요하다. master 노드는 etcd cluster를 백업 저장소로 사용한다.

   - Load balancer는 FQDN을 가진 master node 앞에 두는 것이 좋다. **Kubernetes Cluster를 관리하는 데 사용되는 모든 tool은 이 LB를 통해 해당 cluster에 액세스해야 한다.**

- 마지막으로 worker cluster가 있다. 노드의 수는 1개부터 무한대까지 제한없이 생성 가능하다. Kubernetes의 master와 worker은 서로 통신한다. Docekr Swarm에서는 관리자 노드만 작업자 노드와 통신하고 그 반대는 절대로 하지 않지만, 이쪽에서는 양방향이 가능하다.